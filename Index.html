<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1b5e20">
    <title>–°–∏—Å—Ç–µ–º–∞ 5 –ö—Ä–µ–ø–æ—Å—Ç–µ–π (Pro)</title>
    <style>
        :root {
            --primary: #1b5e20; /* –¢–µ–º–Ω–æ-–∑–µ–ª–µ–Ω—ã–π */
            --bg: #f5f5f5;
            --text: #333;
            --border: #ddd;
            --white: #fff;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0; padding: 0;
            background-color: var(--bg);
            color: var(--text);
            padding-bottom: 80px;
        }

        /* --- –≠–ö–†–ê–ù –í–•–û–î–ê --- */
        #loginOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #fff; z-index: 2000;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .login-box {
            width: 300px; text-align: center; padding: 20px;
            border: 1px solid #eee; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .login-btn {
            display: block; width: 100%; padding: 15px; margin-bottom: 10px;
            background: white; border: 2px solid var(--primary); color: var(--primary);
            font-size: 18px; font-weight: bold; border-radius: 8px; cursor: pointer;
            transition: 0.2s;
        }
        .login-btn:hover { background: var(--primary); color: white; }

        /* --- –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ô–ù–ï–† --- */
        .container { max-width: 900px; margin: 0 auto; padding: 15px; }

        header {
            background: var(--white); padding: 15px; border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); margin-bottom: 20px;
            border-left: 5px solid var(--primary);
            display: flex; justify-content: space-between; align-items: center;
        }
        h1 { margin: 0; font-size: 22px; color: var(--primary); }
        .user-panel { font-size: 14px; text-align: right; }
        .action-link { color: #d32f2f; text-decoration: underline; cursor: pointer; margin-left: 10px; }
        .settings-link { color: #1565c0; text-decoration: underline; cursor: pointer; }

        /* –ò–ù–°–¢–†–£–ö–¶–ò–Ø (5 –ö–†–ï–ü–û–°–¢–ï–ô) */
        .rules-box {
            background: #e8f5e9; padding: 15px; border-radius: 8px;
            border: 1px solid #c8e6c9; margin-bottom: 20px; font-size: 14px; line-height: 1.5;
        }
        .rules-box h3 { margin-top: 0; color: var(--primary); margin-bottom: 10px; }
        .fortress { font-weight: bold; color: #2e7d32; background: #fff; padding: 2px 6px; border-radius: 4px; border: 1px solid #a5d6a7; }

        /* –¢–ê–ë–õ–ò–¶–ê */
        .table-wrap { overflow-x: auto; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        table {
            width: 100%; border-collapse: collapse; background: white; font-size: 14px; min-width: 600px;
        }
        th {
            background: var(--primary); color: white; padding: 12px; text-align: left; white-space: nowrap;
        }
        td {
            border-bottom: 1px solid var(--border); padding: 12px; vertical-align: top;
        }
        tr:nth-child(even) { background-color: #fcfcfc; }
        tr:hover { background-color: #f1f8e9; }

        /* –°—Ç–∏–ª–∏ –∫–æ–ª–æ–Ω–æ–∫ */
        .col-manzil { color: #e65100; font-weight: 500; } /* –û—Ä–∞–Ω–∂–µ–≤—ã–π */
        .col-sabki { color: #0277bd; font-weight: 500; }  /* –°–∏–Ω–∏–π */
        .col-sabak { color: #2e7d32; font-weight: 700; }  /* –ó–µ–ª–µ–Ω—ã–π */

        /* –ß–µ–∫–±–æ–∫—Å */
        input[type="checkbox"] {
            width: 22px; height: 22px; accent-color: var(--primary); cursor: pointer;
        }
        .done-row { background-color: #eeeeee !important; color: #999; text-decoration: line-through; }
        .done-row td span { opacity: 0.5; }

        /* –ú–û–î–ê–õ–ö–ê –ù–ê–°–¢–†–û–ï–ö */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 3000; display: none;
            justify-content: center; align-items: center;
        }
        .modal-box {
            background: white; padding: 25px; border-radius: 12px; width: 90%; max-width: 400px;
        }
        label { display: block; margin-top: 15px; font-weight: bold; font-size: 14px; }
        input, select {
            width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; font-size: 16px;
        }
        .btn-save {
            width: 100%; padding: 12px; margin-top: 20px; background: var(--primary);
            color: white; border: none; border-radius: 6px; font-size: 16px; cursor: pointer; font-weight: bold;
        }
        .btn-cancel {
            width: 100%; padding: 10px; margin-top: 10px; background: transparent;
            border: 1px solid #999; border-radius: 6px; cursor: pointer;
        }

    </style>
</head>
<body>

<!-- –í–•–û–î -->
<div id="loginOverlay">
    <div class="login-box">
        <h2 style="color:var(--primary); margin-top:0;">–°–∏—Å—Ç–µ–º–∞ 5 –ö—Ä–µ–ø–æ—Å—Ç–µ–π</h2>
        <p style="color:#666; margin-bottom:20px;">–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</p>
        <button class="login-btn" onclick="tryLogin('Ayub')">Ayub üîí</button>
        <button class="login-btn" onclick="tryLogin('Abdulla')">Abdulla</button>
        <button class="login-btn" onclick="tryLogin('Daud')">Daud</button>
    </div>
</div>

<!-- –ò–ù–¢–ï–†–§–ï–ô–° -->
<div class="container" id="appContainer" style="display:none;">
    <header>
        <div>
            <h1>–ú–æ–π –ü–ª–∞–Ω –•–∏—Ñ–∑–∞</h1>
            <span style="font-size:12px; color:#666;">–ü–æ –º–µ—Ç–æ–¥—É –¥–æ–∫—Ç–æ—Ä–∞ –Ø—Ö—å—è –∞–ª—å-–ì–∞—É—Å–∞–Ω–∏</span>
        </div>
        <div class="user-panel">
            –ß—Ç–µ—Ü: <strong id="userNameDisp">...</strong><br>
            <span class="settings-link" onclick="openSettings()">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span> | 
            <span class="action-link" onclick="logout()">–í—ã—Ö–æ–¥</span>
        </div>
    </header>

    <div class="rules-box">
        <h3>üìã –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å (–ú–µ—Ç–æ–¥ 5 –ö—Ä–µ–ø–æ—Å—Ç–µ–π):</h3>
        <p><span class="fortress">1. –ú–∞–Ω–∑–∏–ª—å (–ê—Ä—Ö–∏–≤)</span> ‚Äî –≠—Ç–æ –≤–∞—à —Å—Ç–∞—Ä—ã–π –±–∞–≥–∞–∂. –ß–∏—Ç–∞–µ–º –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å. –ï—Å–ª–∏ –∞—Ä—Ö–∏–≤–∞ –º–Ω–æ–≥–æ, –æ–Ω –¥–µ–ª–∏—Ç—Å—è –Ω–∞ —á–∞—Å—Ç–∏.</p>
        <p><span class="fortress">2. –°–∞–±–∫–∏ (–°–≤—è–∑–∫–∞)</span> ‚Äî –≠—Ç–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –≤—ã—É—á–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü. –°–∞–º–∞—è –≤–∞–∂–Ω–∞—è —á–∞—Å—Ç—å. –ß–∏—Ç–∞—Ç—å —Å—Ç—Ä–æ–≥–æ –Ω–∞–∏–∑—É—Å—Ç—å –ø–µ—Ä–µ–¥ –Ω–æ–≤—ã–º —É—Ä–æ–∫–æ–º.</p>
        <p><span class="fortress">3. –°–∞–±–∞–∫ (–ù–æ–≤–æ–µ)</span> ‚Äî –ù–æ–≤—ã–π —É—Ä–æ–∫. –£—á–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ, –Ω–µ –ø–µ—Ä–µ—Ö–æ–¥—è –¥–∞–ª—å—à–µ, –ø–æ–∫–∞ –Ω–µ –±—É–¥–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ.</p>
    </div>

    <div class="table-wrap" id="tableWrapper">
        <!-- –¢–∞–±–ª–∏—Ü–∞ -->
    </div>
</div>

<!-- –ù–ê–°–¢–†–û–ô–ö–ò -->
<div class="modal-overlay" id="settingsModal">
    <div class="modal-box">
        <h2 style="margin-top:0">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã</h2>
        
        <label>–° –∫–∞–∫–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–∞—á–∞—Ç—å?</label>
        <input type="number" id="inpStartPage" value="1" min="1" max="604">

        <label>–° –∫–∞–∫–æ–π —Å—Ç—Ä–æ–∫–∏ –Ω–∞—á–∞—Ç—å? (–û–±—ã—á–Ω–æ 1)</label>
        <input type="number" id="inpStartLine" value="1" min="1" max="15">

        <label>–û–±—ä–µ–º —É—Ä–æ–∫–∞ (–°–∞–±–∞–∫):</label>
        <select id="inpPace">
            <option value="3">3 —Å—Ç—Ä–æ–∫–∏ (–ú–∏–Ω–∏–º—É–º)</option>
            <option value="5">5 —Å—Ç—Ä–æ–∫ (–£–º–µ—Ä–µ–Ω–Ω–æ)</option>
            <option value="7">7 —Å—Ç—Ä–æ–∫ (–ü–æ–ª–æ–≤–∏–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã)</option>
            <option value="15">15 —Å—Ç—Ä–æ–∫ (–¶–µ–ª–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞)</option>
        </select>

        <label>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–ª–∞–Ω–∞:</label>
        <select id="inpDuration">
            <option value="14">2 –Ω–µ–¥–µ–ª–∏</option>
            <option value="30">1 –º–µ—Å—è—Ü</option>
            <option value="60">2 –º–µ—Å—è—Ü–∞</option>
        </select>

        <button class="btn-save" onclick="generateFiveFortressesPlan()">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø–ª–∞–Ω</button>
        <button class="btn-cancel" onclick="closeSettings()">–û—Ç–º–µ–Ω–∞</button>
        <p style="font-size:11px; color:red; text-align:center; margin-top:10px;">‚ö†Ô∏è –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞–Ω–∞ —É–¥–∞–ª–∏—Ç —Å—Ç–∞—Ä—ã–µ –≥–∞–ª–æ—á–∫–∏</p>
    </div>
</div>

<script>
    let currentUser = null;
    let appData = {};

    // --- –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø ---
    function tryLogin(user) {
        if (user === 'Ayub') {
            const p = prompt("–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å:");
            if (p !== '1337') { alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å"); return; }
        }
        currentUser = user;
        localStorage.setItem('hifz_last_user', user);
        document.getElementById('userNameDisp').innerText = user;
        document.getElementById('loginOverlay').style.display = 'none';
        document.getElementById('appContainer').style.display = 'block';
        loadData();
    }

    function logout() {
        currentUser = null;
        localStorage.removeItem('hifz_last_user');
        document.getElementById('appContainer').style.display = 'none';
        document.getElementById('loginOverlay').style.display = 'flex';
    }

    // --- –î–ê–ù–ù–´–ï ---
    function loadData() {
        const json = localStorage.getItem(`hifz_db_${currentUser}`);
        if (json) {
            appData = JSON.parse(json);
            if (!appData.schedule || appData.schedule.length === 0) openSettings();
            else renderTable();
        } else {
            appData = { settings: {startPage:1, startLine:1, pace:5, duration:30}, schedule: [], progress: {} };
            openSettings();
        }
    }

    function saveData() {
        localStorage.setItem(`hifz_db_${currentUser}`, JSON.stringify(appData));
    }

    // --- –ì–õ–ê–í–ù–´–ô –ê–õ–ì–û–†–ò–¢–ú 5 –ö–†–ï–ü–û–°–¢–ï–ô ---
    function generateFiveFortressesPlan() {
        // –ü–æ–ª—É—á–∞–µ–º –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        const startPage = parseInt(document.getElementById('inpStartPage').value);
        const startLine = parseInt(document.getElementById('inpStartLine').value); // 1-15
        const pace = parseInt(document.getElementById('inpPace').value); // –∫–æ–ª-–≤–æ —Å—Ç—Ä–æ–∫ (3, 5, 7, 15)
        const duration = parseInt(document.getElementById('inpDuration').value);

        appData.settings = { startPage, startLine, pace, duration };
        appData.progress = {};
        appData.schedule = [];

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –¢–ï–ö–£–©–ï–ô –ø–æ–∑–∏—Ü–∏–∏ (–≥–¥–µ –º—ã —É—á–∏–º –Ω–æ–≤–æ–µ)
        let currP = startPage;
        let currL = startLine;

        for (let day = 1; day <= duration; day++) {
            let manzilText = "---";
            let sabkiText = "---";
            let sabakText = "";
            let isRest = (day % 7 === 0); // –ö–∞–∂–¥—ã–π 7-–π –¥–µ–Ω—å - –≤—ã—Ö–æ–¥–Ω–æ–π

            // 1. –†–ê–°–ß–ï–¢ –°–ê–ë–ê–ö–ê (–ù–û–í–û–ï)
            // –ú—ã –¥–æ–ª–∂–Ω—ã —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å, –∫–∞–∫–∏–µ —Å—Ç—Ä–æ–∫–∏ —É—á–∏–º —Å–µ–≥–æ–¥–Ω—è
            if (isRest) {
                sabakText = "–ü–û–í–¢–û–†–ï–ù–ò–ï (–ë–µ–∑ –Ω–æ–≤–æ–≥–æ)";
                // –í –≤—ã—Ö–æ–¥–Ω–æ–π –ø–æ–∑–∏—Ü–∏—è –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è
            } else {
                let endL = currL + pace - 1; // –ö–æ–Ω–µ—á–Ω–∞—è —Å—Ç—Ä–æ–∫–∞
                let endP = currP;

                // –ï—Å–ª–∏ –≤—ã—à–ª–∏ –∑–∞ –ø—Ä–µ–¥–µ–ª—ã —Å—Ç—Ä–∞–Ω–∏—Ü—ã (15 —Å—Ç—Ä–æ–∫)
                if (endL > 15) {
                    let linesOnFirstPage = 15 - currL + 1; // —Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ –≤–∑—è–ª–∏ —Å —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä
                    let linesOnNextPage = pace - linesOnFirstPage; // —Å–∫–æ–ª—å–∫–æ –æ—Å—Ç–∞–ª–æ—Å—å –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é
                    
                    sabakText = `–°—Ç—Ä ${currP} (—Å—Ç—Ä–∫ ${currL}-15) + –°—Ç—Ä ${currP+1} (—Å—Ç—Ä–∫ 1-${linesOnNextPage})`;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –Ω–∞ –ó–ê–í–¢–†–ê
                    currP++; 
                    currL = linesOnNextPage + 1;
                } else {
                    // –ï—Å–ª–∏ —É–º–µ—Å—Ç–∏–ª–∏—Å—å –Ω–∞ –æ–¥–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
                    if (pace === 15) {
                         sabakText = `–°—Ç—Ä ${currP} (–ü–æ–ª–Ω–∞—è)`;
                    } else {
                         sabakText = `–°—Ç—Ä ${currP} (—Å—Ç—Ä–∫ ${currL}-${endL})`;
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –Ω–∞ –ó–ê–í–¢–†–ê
                    currL = endL + 1;
                }

                // –ö–æ—Ä—Ä–µ–∫—Ü–∏—è –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏ –Ω–∞ –∑–∞–≤—Ç—Ä–∞
                if (currL > 15) {
                    currL = 1;
                    currP++;
                }
            }

            // 2. –†–ê–°–ß–ï–¢ –°–ê–ë–ö–ò (–°–í–Ø–ó–ö–ê)
            // –≠—Ç–æ —Å—Ç—Ä–æ–≥–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –ü–û–õ–ù–´–• —Å—Ç—Ä–∞–Ω–∏—Ü –î–û —Ç–µ–∫—É—â–µ–≥–æ –°–∞–±–∞–∫–∞.
            // –¢–µ–∫—É—â–∏–π –°–∞–±–∞–∫ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å currP (–∏–ª–∏ currP-1, –µ—Å–ª–∏ –º—ã —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ—à–ª–∏).
            // –î–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è: –°–∞–±–∫–∏ - —ç—Ç–æ 5 —Å—Ç—Ä–∞–Ω–∏—Ü –î–û —Ç–æ–π, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–π –º—ã –°–ï–ô–ß–ê–° –Ω–∞—Ö–æ–¥–∏–º—Å—è.
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º "–¢–æ—á–∫—É –æ—Ç—Å—á–µ—Ç–∞" –¥–ª—è –°–∞–±–∫–∏ (—Ç–µ–∫—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –º–∏–Ω—É—Å 1)
            // –ï—Å–ª–∏ –º—ã –Ω–∞ —Å–µ—Ä–µ–¥–∏–Ω–µ —Å—Ç—Ä 10, —Ç–æ –°–∞–±–∫–∏ –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—Ç—Å—è –Ω–∞ —Å—Ç—Ä 9.
            let sabkiEnd = currP; 
            if (currL > 1) sabkiEnd = currP; // –ï—Å–ª–∏ –º—ã —É–∂–µ –Ω–∞—á–∞–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É, –æ–Ω–∞ –µ—â–µ –Ω–µ –≤ –°–∞–±–∫–∏, –æ–Ω–∞ –≤ "—É—á–µ–±–µ"
            // –ù–æ –ø–æ –º–µ—Ç–æ–¥—É: –°–∞–±–∫–∏ - —ç—Ç–æ –≤—ã—É—á–µ–Ω–Ω–æ–µ. –ï—Å–ª–∏ –º—ã –Ω–∞ —Å—Ç—Ä 6, —Ç–æ –°–∞–±–∫–∏ —ç—Ç–æ 1-5.
            
            // –°–¥–µ–ª–∞–µ–º —Ç–∞–∫: –°–∞–±–∫–∏ –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—Ç—Å—è –Ω–∞ (–¢–µ–∫—É—â–∞—è - 1).
            // –ï—Å–ª–∏ –º—ã –Ω–∞ —Å—Ç—Ä 1, –°–∞–±–∫–∏ –Ω–µ—Ç.
            
            let sabkiLastPage = (currL === 1) ? currP - 1 : currP; 
            // –ï—Å–ª–∏ –º—ã –Ω–∞ –Ω–∞—á–∞–ª–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –∑–Ω–∞—á–∏—Ç –ø—Ä–µ–¥—ã–¥—É—â–∞—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–∫—Ä—ã—Ç–∞.
            // –ï—Å–ª–∏ –º—ã –Ω–∞ —Å–µ—Ä–µ–¥–∏–Ω–µ, —Ç–æ —Ç–µ–∫—É—â–∞—è –µ—â–µ –Ω–µ –∑–∞–∫—Ä—ã—Ç–∞.
            // –£–ø—Ä–æ—â–µ–Ω–∏–µ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã: –±–µ—Ä–µ–º —Ü–µ–ª—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.
            
            let actualSabkiEnd = Math.floor(currP);
            // –ï—Å–ª–∏ –º—ã –Ω–∞ —Å–µ—Ä–µ–¥–∏–Ω–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã, —Å–≤—è–∑–∫–∞ –Ω–µ –≤–∫–ª—é—á–∞–µ—Ç —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É.
            if (currL > 1) actualSabkiEnd = currP - 1; 
            else actualSabkiEnd = currP - 1;

            if (actualSabkiEnd >= startPage) {
                let actualSabkiStart = Math.max(startPage, actualSabkiEnd - 4); // –ë–µ—Ä–µ–º 5 —Å—Ç—Ä–∞–Ω–∏—Ü
                sabkiText = `–°—Ç—Ä ${actualSabkiStart} - ${actualSabkiEnd}`;
            
                // 3. –†–ê–°–ß–ï–¢ –ú–ê–ù–ó–ò–õ–Ø (–ê–†–•–ò–í)
                // –í—Å—ë, —á—Ç–æ –¥–æ –Ω–∞—á–∞–ª–∞ –°–∞–±–∫–∏
                let manzilEnd = actualSabkiStart - 1;
                if (manzilEnd >= startPage) {
                    let totalManzil = manzilEnd - startPage + 1;
                    if (totalManzil <= 10) {
                        manzilText = `–°—Ç—Ä ${startPage} - ${manzilEnd}`;
                    } else {
                        // –î–µ–ª–∏–º –Ω–∞ —á–∞—Å—Ç–∏, –µ—Å–ª–∏ –±–æ–ª—å—à–µ 10
                        let half = Math.floor((startPage + manzilEnd) / 2);
                        if (day % 2 !== 0) manzilText = `–ß–ê–°–¢–¨ –ê: –°—Ç—Ä ${startPage} - ${half}`;
                        else manzilText = `–ß–ê–°–¢–¨ –ë: –°—Ç—Ä ${half+1} - ${manzilEnd}`;
                    }
                }
            }

            appData.schedule.push({ d: day, m: manzilText, s: sabkiText, n: sabakText });
        }

        saveData();
        closeSettings();
        renderTable();
    }

    // --- –û–¢–†–ò–°–û–í–ö–ê ---
    function renderTable() {
        const wrapper = document.getElementById('tableWrapper');
        let html = `
            <table>
                <thead>
                    <tr>
                        <th width="8%">–î–µ–Ω—å</th>
                        <th width="30%">–ú–∞–Ω–∑–∏–ª—å (–ê—Ä—Ö–∏–≤)</th>
                        <th width="25%">–°–∞–±–∫–∏ (–°–≤—è–∑–∫–∞)</th>
                        <th width="30%">–°–∞–±–∞–∫ (–ù–æ–≤–æ–µ)</th>
                        <th width="7%">–û–∫</th>
                    </tr>
                </thead>
                <tbody>
        `;

        appData.schedule.forEach(item => {
            const key = `d${item.d}`;
            const isDone = appData.progress[key];
            const rowClass = isDone ? 'done-row' : '';

            html += `
                <tr class="${rowClass}">
                    <td><strong>${item.d}</strong></td>
                    <td class="col-manzil">${item.m}</td>
                    <td class="col-sabki">${item.s}</td>
                    <td class="col-sabak">${item.n}</td>
                    <td style="text-align:center">
                        <input type="checkbox" ${isDone ? 'checked' : ''} onchange="toggleCheck('${key}')">
                    </td>
                </tr>
            `;
        });

        html += `</tbody></table>`;
        wrapper.innerHTML = html;
    }

    function toggleCheck(key) {
        appData.progress[key] = !appData.progress[key];
        saveData();
        renderTable();
    }

    function openSettings() { document.getElementById('settingsModal').style.display = 'flex'; }
    function closeSettings() { document.getElementById('settingsModal').style.display = 'none'; }

    // Init (–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏–Ω–∞ –Ω–µ –Ω—É–∂–Ω–∞ –∑–¥–µ—Å—å, —ç–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç –≤—Å—ë)
</script>
</body>
</html> 
