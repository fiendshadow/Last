<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#2E7D32">
    <title>–ü–ª–∞–Ω –•–∞—Ñ–∏–∑–∞ (–¢–∞–±–ª–∏—Ü–∞)</title>
    <style>
        :root {
            --primary: #2E7D32; /* –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –∑–µ–ª–µ–Ω—ã–π */
            --bg: #f9f9f9;
            --text: #333;
            --border: #ccc;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0; padding: 0;
            background-color: var(--bg);
            color: var(--text);
            padding-bottom: 60px;
        }

        /* --- –≠–ö–†–ê–ù –í–•–û–î–ê --- */
        #loginOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #ffffff; z-index: 2000;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .login-box {
            width: 300px; text-align: center;
        }
        .login-btn {
            display: block; width: 100%; padding: 15px; margin-bottom: 10px;
            background: white; border: 2px solid var(--primary); color: var(--primary);
            font-size: 18px; font-weight: bold; border-radius: 8px; cursor: pointer;
        }
        .login-btn:hover { background: var(--primary); color: white; }

        /* --- –û–°–ù–û–í–ù–û–ô –ò–ù–¢–ï–†–§–ï–ô–° --- */
        .container { max-width: 800px; margin: 0 auto; padding: 15px; }

        header {
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 3px solid var(--primary); padding-bottom: 15px; margin-bottom: 20px;
        }
        h1 { margin: 0; font-size: 24px; color: var(--primary); }
        .user-info { font-size: 14px; color: #666; text-align: right; }

        /* –ò–ù–°–¢–†–£–ö–¶–ò–Ø */
        .instruction-box {
            background: #e8f5e9; border: 1px solid #c8e6c9;
            padding: 15px; border-radius: 8px; margin-bottom: 20px; font-size: 14px;
        }
        .instruction-box h3 { margin-top: 0; color: var(--primary); }
        .term { font-weight: bold; color: #1b5e20; }

        /* –¢–ê–ë–õ–ò–¶–ê */
        table {
            width: 100%; border-collapse: collapse; background: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); font-size: 14px;
        }
        th {
            background: var(--primary); color: white; padding: 12px 8px; text-align: left;
        }
        td {
            border-bottom: 1px solid var(--border); padding: 10px 8px; vertical-align: top;
        }
        tr:nth-child(even) { background-color: #f1f1f1; }
        
        /* –ì–∞–ª–æ—á–∫–∞ */
        input[type="checkbox"] {
            transform: scale(1.5); cursor: pointer; accent-color: var(--primary);
        }
        .done-row { text-decoration: line-through; color: #999; background: #eee !important; }

        /* –ù–ê–°–¢–†–û–ô–ö–ò (–ú–û–î–ê–õ–ö–ê) */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; z-index: 1000;
        }
        .modal-content {
            background: white; padding: 25px; border-radius: 10px; width: 90%; max-width: 400px;
        }
        label { display: block; margin-top: 10px; font-weight: bold; }
        select, input { width: 100%; padding: 10px; margin-top: 5px; box-sizing: border-box; }
        .btn-action {
            width: 100%; padding: 12px; margin-top: 15px; background: var(--primary);
            color: white; border: none; font-size: 16px; cursor: pointer; border-radius: 5px;
        }
        .btn-outline { background: transparent; border: 1px solid #999; color: #333; margin-top: 10px; }

    </style>
</head>
<body>

<!-- 1. –í–•–û–î -->
<div id="loginOverlay">
    <div class="login-box">
        <h2 style="color:var(--primary)">–ê—Å-—Å–∞–ª—è–º—É –∞–ª–µ–π–∫—É–º</h2>
        <p>–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å:</p>
        <button class="login-btn" onclick="attemptLogin('Ayub')">Ayub üîí</button>
        <button class="login-btn" onclick="attemptLogin('Abdulla')">Abdulla</button>
        <button class="login-btn" onclick="attemptLogin('Daud')">Daud</button>
    </div>
</div>

<!-- 2. –û–°–ù–û–í–ù–û–ô –≠–ö–†–ê–ù -->
<div class="container" id="appContainer" style="display:none;">
    <header>
        <div>
            <h1>–ü–ª–∞–Ω –•–∏—Ñ–∑–∞</h1>
            <span style="font-size:12px; color:#666;">–ú–µ—Ç–æ–¥ 5 –∫—Ä–µ–ø–æ—Å—Ç–µ–π</span>
        </div>
        <div class="user-info">
            –ß—Ç–µ—Ü: <strong id="userNameDisplay">...</strong><br>
            <button onclick="openSettings()" style="background:none; border:none; color:blue; cursor:pointer; text-decoration:underline;">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button> | 
            <button onclick="logout()" style="background:none; border:none; color:red; cursor:pointer; text-decoration:underline;">–í—ã—Ö–æ–¥</button>
        </div>
    </header>

    <div class="instruction-box">
        <h3>üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è</h3>
        <p><span class="term">1. –ú–∞–Ω–∑–∏–ª—å (–ê—Ä—Ö–∏–≤):</span> –°—Ç–∞—Ä—ã–µ –≤—ã—É—á–µ–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã. –ß–∏—Ç–∞—Ç—å –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å (—Å –ª–∏—Å—Ç–∞ –∏–ª–∏ –Ω–∞–∏–∑—É—Å—Ç—å).</p>
        <p><span class="term">2. –°–∞–±–∫–∏ (–°–≤—è–∑–∫–∞):</span> –ü–æ—Å–ª–µ–¥–Ω–∏–µ 5 —Å—Ç—Ä–∞–Ω–∏—Ü. –ß–∏—Ç–∞—Ç—å —Å—Ç—Ä–æ–≥–æ –Ω–∞–∏–∑—É—Å—Ç—å, –±–µ–∑ –æ—à–∏–±–æ–∫.</p>
        <p><span class="term">3. –°–∞–±–∞–∫ (–ù–æ–≤–æ–µ):</span> –ù–æ–≤—ã–π —É—Ä–æ–∫. –£—á–∏—Ç—å –ø–æ—Å–ª–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è.</p>
    </div>

    <div id="tableWrapper">
        <!-- –¢–∞–±–ª–∏—Ü–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∑–¥–µ—Å—å -->
    </div>
</div>

<!-- 3. –ù–ê–°–¢–†–û–ô–ö–ò -->
<div class="modal" id="settingsModal">
    <div class="modal-content">
        <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–ª–∞–Ω–∞</h2>
        
        <label>–° –∫–∞–∫–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–∞—á–∞—Ç—å?</label>
        <input type="number" id="inpStart" value="1">

        <label>–û–±—ä–µ–º –≤ –¥–µ–Ω—å</label>
        <select id="inpPace">
            <option value="3">3 —Å—Ç—Ä–æ–∫–∏</option>
            <option value="5">5 —Å—Ç—Ä–æ–∫</option>
            <option value="7">7 —Å—Ç—Ä–æ–∫</option>
            <option value="0.5">–ü–æ–ª–æ–≤–∏–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã</option>
            <option value="1">–¶–µ–ª–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞</option>
        </select>

        <label>–ù–∞ —Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π —Å–æ—Å—Ç–∞–≤–∏—Ç—å?</label>
        <select id="inpDuration">
            <option value="7">1 –Ω–µ–¥–µ–ª—è</option>
            <option value="14">2 –Ω–µ–¥–µ–ª–∏</option>
            <option value="30">1 –º–µ—Å—è—Ü</option>
            <option value="60">2 –º–µ—Å—è—Ü–∞</option>
        </select>

        <button class="btn-action" onclick="generatePlan()">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø–ª–∞–Ω</button>
        <button class="btn-action btn-outline" onclick="closeSettings()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
</div>

<script>
    let currentUser = null;
    let data = {};

    // --- –õ–û–ì–ò–ö–ê –í–•–û–î–ê ---
    function init() {
        const last = localStorage.getItem('qp_final_user');
        if (last) {
            // –ï—Å–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω Ayub, –≤—Å–µ —Ä–∞–≤–Ω–æ —Å–ø—Ä–æ—Å–∏–º –ø–∞—Ä–æ–ª—å –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ,
            // –∏–ª–∏ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –∞–≤—Ç–æ-–≤—Ö–æ–¥. –°–¥–µ–ª–∞–µ–º –∞–≤—Ç–æ-–≤—Ö–æ–¥ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞, –∫—Ä–æ–º–µ Ayub?
            // –ù–µ—Ç, –ø–æ —É—Å–ª–æ–≤–∏—é –∑–∞–¥–∞—á–∏ –ø—Ä–æ—Å—Ç–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è. –°–¥–µ–ª–∞–µ–º —á–∏—Å—Ç–æ.
            // –î–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –æ—Å—Ç–∞–≤–∏–º —ç–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞ –≤—Å–µ–≥–¥–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏.
        }
    }

    function attemptLogin(user) {
        if (user === 'Ayub') {
            const pass = prompt("–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è Ayub:");
            if (pass !== '1337') {
                alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!");
                return;
            }
        }
        
        currentUser = user;
        localStorage.setItem('qp_final_user', user);
        document.getElementById('userNameDisplay').innerText = user;
        document.getElementById('loginOverlay').style.display = 'none';
        document.getElementById('appContainer').style.display = 'block';
        
        loadData();
    }

    function logout() {
        currentUser = null;
        localStorage.removeItem('qp_final_user');
        document.getElementById('appContainer').style.display = 'none';
        document.getElementById('loginOverlay').style.display = 'flex';
    }

    // --- –î–ê–ù–ù–´–ï ---
    function loadData() {
        const json = localStorage.getItem(`qp_data_${currentUser}`);
        if (json) {
            data = JSON.parse(json);
            if (!data.schedule || data.schedule.length === 0) openSettings();
            else renderTable();
        } else {
            data = { settings: {start:1, pace:0.5, duration:30}, schedule: [], progress: {} };
            
